<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanças Pessoais | MyMoney</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --dark-color: #1b263b;
            --light-color: #f8f9fa;
            --success-color: #4cc9f0;
            --warning-color: #f8961e;
            --danger-color: #f72585;
            --gray-color: #adb5bd;
            --white-color: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background-color: var(--dark-color);
            color: var(--light-color);
            padding: 1.5rem 0;
            transition: all 0.3s ease;
            z-index: 1000;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h2 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--white-color);
        }

        .sidebar-header h2 i {
            color: var(--accent-color);
        }

        .sidebar-menu {
            padding: 1.5rem 0;
        }

        .menu-item {
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--gray-color);
            text-decoration: none;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--white-color);
        }

        .menu-item.active {
            background-color: rgba(67, 97, 238, 0.2);
            color: var(--white-color);
            border-left: 3px solid var(--primary-color);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
        }

        .hamburger {
            display: none;
            background: none;
            border: none;
            color: var(--light-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            z-index: 1100;
            position: fixed;
            top: 1rem;
            left: 1rem;
            background-color: var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .hamburger.active {
            left: calc(250px + 1rem);
            background-color: var(--danger-color);
        }

        /* Main Content */
        .main-content {
            padding: 1.5rem;
            overflow-y: auto;
            padding-bottom: 80px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            color: var(--dark-color);
            font-weight: 600;
            font-size: 1.5rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            flex-shrink: 0;
        }

        /* Cards */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .card {
            background-color: var(--white-color);
            border-radius: 10px;
            padding: 1.25rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 0.9rem;
            color: var(--gray-color);
            font-weight: 500;
        }

        .card-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .card-icon.income {
            background-color: var(--success-color);
        }

        .card-icon.expense {
            background-color: var(--danger-color);
        }

        .card-icon.balance {
            background-color: var(--primary-color);
        }

        .card-icon.investment {
            background-color: var(--warning-color);
        }

        .card-value {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .card-footer {
            font-size: 0.8rem;
            color: var(--gray-color);
        }

        /* Charts */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background-color: var(--white-color);
            border-radius: 10px;
            padding: 1.25rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .chart-title {
            font-size: 1.1rem;
            color: var(--dark-color);
            font-weight: 600;
        }

        .chart-year-selector {
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 0.85rem;
        }

        .chart-wrapper {
            position: relative;
            height: 250px;
            min-height: 200px;
            width: 100%;
            overflow: hidden;
        }

        /* Tables */
        .table-container {
            background-color: var(--white-color);
            border-radius: 10px;
            padding: 1.25rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            overflow-x: auto;
        }

        .table-title {
            font-size: 1.1rem;
            margin-bottom: 1.25rem;
            color: var(--dark-color);
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            font-weight: 600;
            color: var(--gray-color);
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        td {
            font-size: 0.85rem;
        }

        .status {
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status.paid {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
        }

        .status.pending {
            background-color: rgba(248, 150, 30, 0.1);
            color: var(--warning-color);
        }

        .status.overdue {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger-color);
        }

        /* Form */
        .form-container {
            background-color: var(--white-color);
            border-radius: 10px;
            padding: 1.25rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
        }

        .compact-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .form-title {
            font-size: 1.1rem;
            margin-bottom: 1.25rem;
            color: var(--dark-color);
            font-weight: 600;
            grid-column: 1 / -1;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.375rem;
            font-size: 0.8rem;
            color: var(--gray-color);
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.6rem 0.8rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.85rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            padding: 0.6rem 1.25rem;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-block {
            width: 100%;
            grid-column: 1 / -1;
        }

        .btn-sm {
            padding: 0.35rem 0.7rem;
            font-size: 0.75rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 1.25rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            margin: 1rem;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
        }

        /* Progress bar for goals */
        .progress-container {
            width: 100%;
            height: 8px;
            background-color: #eee;
            border-radius: 4px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Responsive */
        @media (min-width: 768px) {
            .compact-form {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 992px) {
            .container {
                grid-template-columns: 80px 1fr;
            }

            .sidebar-header h2 span, .menu-item span {
                display: none;
            }

            .sidebar-header, .menu-item {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
                justify-content: center;
            }

            .menu-item i {
                font-size: 1.25rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: -250px;
                width: 250px;
                height: 100vh;
                padding: 1.5rem 0;
                transition: all 0.3s ease;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            .sidebar.active {
                left: 0;
            }

            .sidebar-header {
                display: flex;
                padding: 0 1rem 1.5rem;
            }

            .sidebar-header h2 span {
                display: inline;
            }

            .sidebar-menu {
                padding: 1rem 0;
            }

            .menu-item {
                flex-direction: row;
                justify-content: flex-start;
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
                gap: 0.75rem;
            }

            .menu-item i {
                font-size: 1rem;
            }

            .menu-item span {
                display: inline;
            }

            .main-content {
                padding-bottom: 80px;
                transition: margin-left 0.3s ease;
            }

            .main-content.shifted {
                margin-left: 250px;
            }

            /* Ajustes para gráficos em telas pequenas */
            .chart-wrapper {
                height: 220px;
            }

            .chart-card {
                padding: 1rem;
            }

            .chart-title {
                font-size: 1rem;
            }

            .chart-year-selector {
                font-size: 0.8rem;
                padding: 0.3rem 0.5rem;
            }

            /* Mostrar hamburger apenas em telas pequenas */
            .hamburger {
                display: flex;
            }

            /* Ajustes para gráficos em telas muito pequenas */
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .chart-title {
                margin-bottom: 0.5rem;
            }

            .chart-year-selector {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            .user-profile {
                width: 100%;
                justify-content: flex-end;
            }

            .cards-container {
                grid-template-columns: 1fr;
            }
            
            .card-value {
                font-size: 1.3rem;
            }
            
            .header h1 {
                font-size: 1.3rem;
            }

            .chart-wrapper {
                height: 200px;
            }

            /* Ajuste para gráficos não cortarem em telas pequenas */
            .chart-wrapper canvas {
                max-width: 100%;
                height: auto !important;
            }
        }

        /* Mobile menu overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .overlay.active {
            display: block;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    <button class="hamburger" id="hamburgerMenu">
        <i class="fas fa-bars"></i>
    </button>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-wallet"></i> <span>MyMoney</span></h2>
            </div>
            <nav class="sidebar-menu">
                <a href="#dashboard" class="menu-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#transactions" class="menu-item" data-section="transactions">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Transações</span>
                </a>
                <a href="#cards" class="menu-item" data-section="cards">
                    <i class="fas fa-credit-card"></i>
                    <span>Cartões</span>
                </a>
                <a href="#investments" class="menu-item" data-section="investments">
                    <i class="fas fa-chart-line"></i>
                    <span>Investimentos</span>
                </a>
                <a href="#invoices" class="menu-item" data-section="invoices">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Faturas</span>
                </a>
                <a href="#goals" class="menu-item" data-section="goals">
                    <i class="fas fa-piggy-bank"></i>
                    <span>Metas</span>
                </a>
                <a href="#settings" class="menu-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Configurações</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard Section -->
            <section id="dashboard-section">
                <div class="header">
                    <h1>Dashboard Financeiro</h1>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">JS</div>
                        <span id="userName">João Silva</span>
                    </div>
                </div>

                <!-- Cards -->
                <div class="cards-container">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Receitas</h3>
                            <div class="card-icon income">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                        </div>
                        <div class="card-value" id="incomeValue">R$ 0,00</div>
                        <div class="card-footer" id="incomeChange">+0% em relação ao mês passado</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Despesas</h3>
                            <div class="card-icon expense">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                        </div>
                        <div class="card-value" id="expenseValue">R$ 0,00</div>
                        <div class="card-footer" id="expenseChange">+0% em relação ao mês passado</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Saldo Atual</h3>
                            <div class="card-icon balance">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <div class="card-value" id="balanceValue">R$ 0,00</div>
                        <div class="card-footer">Disponível em 3 contas</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Investimentos</h3>
                            <div class="card-icon investment">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value" id="investmentValue">R$ 0,00</div>
                        <div class="card-footer" id="investmentPerformance">+0% este ano</div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Receitas vs Despesas</h3>
                            <select class="chart-year-selector" id="incomeExpenseYear">
                                <!-- Options will be added dynamically -->
                            </select>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="incomeExpenseChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Distribuição de Gastos</h3>
                            <select class="chart-year-selector" id="expenseDistributionYear">
                                <!-- Options will be added dynamically -->
                            </select>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="expenseDistributionChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Evolução de Receitas por Categoria</h3>
                            <select class="chart-year-selector" id="incomeByCategoryYear">
                                <!-- Options will be added dynamically -->
                            </select>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="incomeByCategoryChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Evolução de Despesas por Categoria</h3>
                            <select class="chart-year-selector" id="expenseByCategoryYear">
                                <!-- Options will be added dynamically -->
                            </select>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="expenseByCategoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Transactions Table -->
                <div class="table-container">
                    <h3 class="table-title">Últimas Transações</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Descrição</th>
                                <th>Categoria</th>
                                <th>Data</th>
                                <th>Valor</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentTransactionsBody">
                            <!-- Transações serão adicionadas dinamicamente aqui -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Transactions Section (hidden by default) -->
            <section id="transactions-section" style="display: none;">
                <div class="header">
                    <h1>Transações</h1>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar2">JS</div>
                        <span id="userName2">João Silva</span>
                    </div>
                </div>

                <!-- Add Transaction Form -->
                <div class="form-container">
                    <form id="transactionForm" class="compact-form">
                        <h3 class="form-title">Adicionar Transação</h3>
                        <div class="form-group">
                            <label for="description">Descrição</label>
                            <input type="text" id="description" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="amount">Valor</label>
                            <input type="number" id="amount" class="form-control" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="type">Tipo</label>
                            <select id="type" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="income">Receita</option>
                                <option value="expense">Despesa</option>
                                <option value="investment">Investimento</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="category">Categoria</label>
                            <select id="category" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="salary">Salário</option>
                                <option value="rent">Aluguel</option>
                                <option value="food">Alimentação</option>
                                <option value="transport">Transporte</option>
                                <option value="health">Saúde</option>
                                <option value="leisure">Lazer</option>
                                <option value="education">Educação</option>
                                <option value="investment">Investimento</option>
                                <option value="other">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="date">Data</label>
                            <input type="date" id="date" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Adicionar Transação</button>
                    </form>
                </div>

                <!-- All Transactions Table -->
                <div class="table-container">
                    <h3 class="table-title">Todas as Transações</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Descrição</th>
                                <th>Tipo</th>
                                <th>Categoria</th>
                                <th>Data</th>
                                <th>Valor</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTableBody">
                            <!-- Transactions will be added here dynamically -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Cards Section (hidden by default) -->
            <section id="cards-section" style="display: none;">
                <div class="header">
                    <h1>Cartões de Crédito</h1>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar3">JS</div>
                        <span id="userName3">João Silva</span>
                    </div>
                </div>

                <div class="cards-container" id="creditCardsContainer">
                    <!-- Cartões serão adicionados dinamicamente aqui -->
                </div>

                <div class="form-container">
                    <form id="cardForm" class="compact-form">
                        <h3 class="form-title">Adicionar Cartão</h3>
                        <div class="form-group">
                            <label for="cardName">Nome do Cartão</label>
                            <input type="text" id="cardName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="cardNumber">Número do Cartão</label>
                            <input type="text" id="cardNumber" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="cardLimit">Limite</label>
                            <input type="number" id="cardLimit" class="form-control" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="cardDueDay">Dia de Vencimento</label>
                            <input type="number" id="cardDueDay" class="form-control" min="1" max="31" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Adicionar Cartão</button>
                    </form>
                </div>
            </section>

            <!-- Investments Section (hidden by default) -->
            <section id="investments-section" style="display: none;">
                <div class="header">
                    <h1>Investimentos</h1>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar4">JS</div>
                        <span id="userName4">João Silva</span>
                    </div>
                </div>

                <div class="cards-container">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Total Investido</h3>
                            <div class="card-icon investment">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value" id="totalInvested">R$ 0,00</div>
                        <div class="card-footer" id="investmentPerformance">+0% este ano</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Rendimento Mensal</h3>
                            <div class="card-icon income">
                                <i class="fas fa-coins"></i>
                            </div>
                        </div>
                        <div class="card-value" id="monthlyYield">R$ 0,00</div>
                        <div class="card-footer" id="monthlyPerformance">+0% em relação ao mês passado</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 class="table-title">Carteira de Investimentos</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Ativo</th>
                                <th>Tipo</th>
                                <th>Quantidade</th>
                                <th>Valor Investido</th>
                                <th>Valor Atual</th>
                                <th>Rentabilidade</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="investmentsTableBody">
                            <!-- Investimentos serão adicionados dinamicamente aqui -->
                        </tbody>
                    </table>
                </div>

                <div class="form-container">
                    <form id="investmentForm" class="compact-form">
                        <h3 class="form-title">Novo Investimento</h3>
                        <div class="form-group">
                            <label for="investmentName">Nome do Ativo</label>
                            <input type="text" id="investmentName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="investmentType">Tipo</label>
                            <select id="investmentType" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="fixed-income">Renda Fixa</option>
                                <option value="stocks">Ações</option>
                                <option value="fii">Fundo Imobiliário</option>
                                <option value="treasury">Tesouro Direto</option>
                                <option value="etf">ETF</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="investmentAmount">Valor Investido</label>
                            <input type="number" id="investmentAmount" class="form-control" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="investmentQuantity">Quantidade</label>
                            <input type="number" id="investmentQuantity" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="investmentCurrentValue">Valor Atual (opcional)</label>
                            <input type="number" id="investmentCurrentValue" class="form-control" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="investmentDate">Data da Aplicação</label>
                            <input type="date" id="investmentDate" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Adicionar Investimento</button>
                    </form>
                </div>
            </section>

            <!-- Invoices Section (hidden by default) -->
            <section id="invoices-section" style="display: none;">
                <div class="header">
                    <h1>Faturas</h1>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar5">JS</div>
                        <span id="userName5">João Silva</span>
                    </div>
                </div>

                <div class="cards-container" id="invoicesCardsContainer">
                    <!-- Faturas serão adicionadas dinamicamente aqui -->
                </div>

                <div class="form-container">
                    <form id="invoiceForm" class="compact-form">
                        <h3 class="form-title">Adicionar Fatura</h3>
                        <div class="form-group">
                            <label for="invoiceCard">Cartão</label>
                            <select id="invoiceCard" class="form-control" required>
                                <option value="">Selecione um cartão...</option>
                                <!-- Options will be added dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="invoiceMonth">Mês/Ano</label>
                            <input type="month" id="invoiceMonth" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="invoiceAmount">Valor Total</label>
                            <input type="number" id="invoiceAmount" class="form-control" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="invoiceStatus">Status</label>
                            <select id="invoiceStatus" class="form-control" required>
                                <option value="paid">Pago</option>
                                <option value="pending">Pendente</option>
                                <option value="overdue">Atrasado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="invoiceDueDate">Data de Vencimento</label>
                            <input type="date" id="invoiceDueDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="invoicePaymentDate">Data de Pagamento (se pago)</label>
                            <input type="date" id="invoicePaymentDate" class="form-control">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Adicionar Fatura</button>
                    </form>
                </div>

                <div class="table-container">
                    <h3 class="table-title">Histórico de Faturas</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Cartão</th>
                                <th>Mês/Ano</th>
                                <th>Valor Total</th>
                                <th>Status</th>
                                <th>Data de Pagamento</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="invoicesTableBody">
                            <!-- Faturas serão adicionadas dinamicamente aqui -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Goals Section (hidden by default) -->
            <section id="goals-section" style="display: none;">
                <div class="header">
                    <h1>Metas Financeiras</h1>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar6">JS</div>
                        <span id="userName6">João Silva</span>
                    </div>
                </div>

                <div class="cards-container" id="goalsContainer">
                    <!-- Metas serão adicionadas dinamicamente aqui -->
                </div>

                <div class="form-container">
                    <form id="goalForm" class="compact-form">
                        <h3 class="form-title">Nova Meta</h3>
                        <div class="form-group">
                            <label for="goalName">Nome da Meta</label>
                            <input type="text" id="goalName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="goalTarget">Valor Alvo</label>
                            <input type="number" id="goalTarget" class="form-control" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="goalCurrent">Valor Atual</label>
                            <input type="number" id="goalCurrent" class="form-control" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="goalDeadline">Prazo</label>
                            <input type="date" id="goalDeadline" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Adicionar Meta</button>
                    </form>
                </div>

                <div class="table-container">
                    <h3 class="table-title">Minhas Metas</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Meta</th>
                                <th>Valor Alvo</th>
                                <th>Valor Atual</th>
                                <th>Progresso</th>
                                <th>Prazo</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="goalsTableBody">
                            <!-- Metas serão adicionadas dinamicamente aqui -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Settings Section (hidden by default) -->
            <section id="settings-section" style="display: none;">
                <div class="header">
                    <h1>Configurações</h1>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar7">JS</div>
                        <span id="userName7">João Silva</span>
                    </div>
                </div>

                <div class="cards-container">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Perfil do Usuário</h3>
                            <div class="card-icon" style="background-color: var(--primary-color);">
                                <i class="fas fa-user"></i>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 1rem;">
                            <label for="userFullName">Nome Completo</label>
                            <input type="text" id="userFullName" class="form-control" value="João Silva">
                        </div>
                        <button id="saveProfileBtn" class="btn btn-primary btn-block" style="margin-top: 1rem;">Salvar Alterações</button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Categorias</h3>
                            <div class="card-icon income">
                                <i class="fas fa-tags"></i>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="newCategory">Adicionar Categoria</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" id="newCategory" class="form-control" placeholder="Nome da categoria">
                                <button id="addCategoryBtn" class="btn btn-primary">Adicionar</button>
                            </div>
                        </div>
                        <div style="margin-top: 1rem;">
                            <h4 style="margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--gray-color);">Minhas Categorias</h4>
                            <ul id="categoriesList" style="list-style: none;">
                                <!-- Categorias serão adicionadas dinamicamente aqui -->
                            </ul>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Contas Bancárias</h3>
                            <div class="card-icon balance">
                                <i class="fas fa-university"></i>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="bankName">Nome do Banco</label>
                            <input type="text" id="bankName" class="form-control" placeholder="Ex: Banco do Brasil">
                        </div>
                        <div class="form-group">
                            <label for="accountType">Tipo de Conta</label>
                            <select id="accountType" class="form-control">
                                <option value="checking">Conta Corrente</option>
                                <option value="savings">Conta Poupança</option>
                                <option value="investment">Conta Investimento</option>
                            </select>
                        </div>
                        <button id="addBankAccountBtn" class="btn btn-primary btn-block">Adicionar Conta</button>
                        
                        <div style="margin-top: 1.5rem;">
                            <h4 style="margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--gray-color);">Minhas Contas</h4>
                            <ul id="bankAccountsList" style="list-style: none;">
                                <!-- Contas bancárias serão adicionadas dinamicamente aqui -->
                            </ul>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Edit Transaction Modal -->
    <div class="modal" id="editTransactionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Transação</h3>
                <button class="close-modal" onclick="closeModal('editTransactionModal')">&times;</button>
            </div>
            <form id="editTransactionForm" class="compact-form">
                <input type="hidden" id="editTransactionId">
                <div class="form-group">
                    <label for="editDescription">Descrição</label>
                    <input type="text" id="editDescription" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editAmount">Valor</label>
                    <input type="number" id="editAmount" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editType">Tipo</label>
                    <select id="editType" class="form-control" required>
                        <option value="income">Receita</option>
                        <option value="expense">Despesa</option>
                        <option value="investment">Investimento</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editCategory">Categoria</label>
                    <select id="editCategory" class="form-control" required>
                        <option value="salary">Salário</option>
                        <option value="rent">Moradia</option>
                        <option value="food">Alimentação</option>
                        <option value="transport">Transporte</option>
                        <option value="health">Saúde</option>
                        <option value="leisure">Lazer</option>
                        <option value="education">Educação</option>
                        <option value="investment">Investimento</option>
                        <option value="other">Outros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editDate">Data</label>
                    <input type="date" id="editDate" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Salvar Alterações</button>
            </form>
        </div>
    </div>

    <!-- Edit Card Modal -->
    <div class="modal" id="editCardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Cartão</h3>
                <button class="close-modal" onclick="closeModal('editCardModal')">&times;</button>
            </div>
            <form id="editCardForm" class="compact-form">
                <input type="hidden" id="editCardId">
                <div class="form-group">
                    <label for="editCardName">Nome do Cartão</label>
                    <input type="text" id="editCardName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editCardNumber">Número do Cartão</label>
                    <input type="text" id="editCardNumber" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editCardLimit">Limite</label>
                    <input type="number" id="editCardLimit" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editCardDueDay">Dia de Vencimento</label>
                    <input type="number" id="editCardDueDay" class="form-control" min="1" max="31" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Salvar Alterações</button>
            </form>
        </div>
    </div>

    <!-- Edit Investment Modal -->
    <div class="modal" id="editInvestmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Investimento</h3>
                <button class="close-modal" onclick="closeModal('editInvestmentModal')">&times;</button>
            </div>
            <form id="editInvestmentForm" class="compact-form">
                <input type="hidden" id="editInvestmentId">
                <div class="form-group">
                    <label for="editInvestmentName">Nome do Ativo</label>
                    <input type="text" id="editInvestmentName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editInvestmentType">Tipo</label>
                    <select id="editInvestmentType" class="form-control" required>
                        <option value="fixed-income">Renda Fixa</option>
                        <option value="stocks">Ações</option>
                        <option value="fii">Fundo Imobiliário</option>
                        <option value="treasury">Tesouro Direto</option>
                        <option value="etf">ETF</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editInvestmentAmount">Valor Investido</label>
                    <input type="number" id="editInvestmentAmount" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editInvestmentQuantity">Quantidade</label>
                    <input type="number" id="editInvestmentQuantity" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editInvestmentCurrentValue">Valor Atual</label>
                    <input type="number" id="editInvestmentCurrentValue" class="form-control" step="0.01">
                </div>
                <div class="form-group">
                    <label for="editInvestmentDate">Data da Aplicação</label>
                    <input type="date" id="editInvestmentDate" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Salvar Alterações</button>
            </form>
        </div>
    </div>

    <!-- Edit Goal Modal -->
    <div class="modal" id="editGoalModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Meta</h3>
                <button class="close-modal" onclick="closeModal('editGoalModal')">&times;</button>
            </div>
            <form id="editGoalForm" class="compact-form">
                <input type="hidden" id="editGoalId">
                <div class="form-group">
                    <label for="editGoalName">Nome da Meta</label>
                    <input type="text" id="editGoalName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editGoalTarget">Valor Alvo</label>
                    <input type="number" id="editGoalTarget" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editGoalCurrent">Valor Atual</label>
                    <input type="number" id="editGoalCurrent" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editGoalDeadline">Prazo</label>
                    <input type="date" id="editGoalDeadline" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Salvar Alterações</button>
            </form>
        </div>
    </div>

    <!-- Edit Invoice Modal -->
    <div class="modal" id="editInvoiceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Fatura</h3>
                <button class="close-modal" onclick="closeModal('editInvoiceModal')">&times;</button>
            </div>
            <form id="editInvoiceForm" class="compact-form">
                <input type="hidden" id="editInvoiceId">
                <div class="form-group">
                    <label for="editInvoiceCard">Cartão</label>
                    <select id="editInvoiceCard" class="form-control" required>
                        <!-- Options will be added dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="editInvoiceMonth">Mês/Ano</label>
                    <input type="month" id="editInvoiceMonth" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editInvoiceAmount">Valor Total</label>
                    <input type="number" id="editInvoiceAmount" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editInvoiceStatus">Status</label>
                    <select id="editInvoiceStatus" class="form-control" required>
                        <option value="paid">Pago</option>
                        <option value="pending">Pendente</option>
                        <option value="overdue">Atrasado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editInvoiceDueDate">Data de Vencimento</label>
                    <input type="date" id="editInvoiceDueDate" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editInvoicePaymentDate">Data de Pagamento (se pago)</label>
                    <input type="date" id="editInvoicePaymentDate" class="form-control">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Salvar Alterações</button>
            </form>
        </div>
    </div>

    <script>
        // Dados iniciais
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [
            { id: 1, description: 'Salário', type: 'income', category: 'salary', date: '2023-06-05', amount: 8450.00 },
            { id: 2, description: 'Aluguel', type: 'expense', category: 'rent', date: '2023-06-01', amount: -2500.00 },
            { id: 3, description: 'Supermercado', type: 'expense', category: 'food', date: '2023-06-03', amount: -780.50 },
            { id: 4, description: 'Internet', type: 'expense', category: 'other', date: '2023-06-10', amount: -120.00 },
            { id: 5, description: 'Academia', type: 'expense', category: 'health', date: '2023-06-15', amount: -150.00 },
            { id: 6, description: 'Freelance', type: 'income', category: 'other', date: '2023-05-20', amount: 1200.00 },
            { id: 7, description: 'Restaurante', type: 'expense', category: 'food', date: '2023-05-12', amount: -85.00 },
            { id: 8, description: 'Uber', type: 'expense', category: 'transport', date: '2023-05-08', amount: -45.00 }
        ];

        let categories = JSON.parse(localStorage.getItem('categories')) || ['Alimentação', 'Transporte', 'Lazer', 'Moradia', 'Saúde', 'Educação', 'Investimentos', 'Outros'];
        let bankAccounts = JSON.parse(localStorage.getItem('bankAccounts')) || [
            { id: 1, bank: 'Banco do Brasil', type: 'checking' }
        ];
        let creditCards = JSON.parse(localStorage.getItem('creditCards')) || [
            { id: 1, name: 'Cartão Nubank', number: '**** **** **** 1234', limit: 5000, dueDay: 15 },
            { id: 2, name: 'Cartão Itaú', number: '**** **** **** 5678', limit: 3000, dueDay: 20 }
        ];
        let investments = JSON.parse(localStorage.getItem('investments')) || [
            { id: 1, name: 'CDB Banco XP', type: 'fixed-income', amount: 10000, quantity: 1, currentValue: 10850, date: '2023-01-15' },
            { id: 2, name: 'PETR4', type: 'stocks', amount: 2500, quantity: 100, currentValue: 3200, date: '2023-03-10' }
        ];
        let goals = JSON.parse(localStorage.getItem('goals')) || [
            { id: 1, name: 'Reserva de Emergência', target: 20000, current: 15000, deadline: '2023-12-31' },
            { id: 2, name: 'Viagem Internacional', target: 10000, current: 5000, deadline: '2024-06-30' }
        ];
        let invoices = JSON.parse(localStorage.getItem('invoices')) || [
            { id: 1, cardId: 1, month: '2023-06', amount: 1245.90, status: 'pending', dueDate: '2023-07-15', paymentDate: '' },
            { id: 2, cardId: 2, month: '2023-06', amount: 890.50, status: 'pending', dueDate: '2023-07-20', paymentDate: '' },
            { id: 3, cardId: 1, month: '2023-05', amount: 1150.00, status: 'paid', dueDate: '2023-06-15', paymentDate: '2023-06-10' },
            { id: 4, cardId: 2, month: '2023-05', amount: 750.00, status: 'paid', dueDate: '2023-06-20', paymentDate: '2023-06-15' }
        ];
        let userName = localStorage.getItem('userName') || 'João Silva';

        // Variáveis para armazenar os gráficos
        let incomeExpenseChart;
        let expenseDistributionChart;
        let incomeByCategoryChart;
        let expenseByCategoryChart;
        let currentYear = new Date().getFullYear();

        // Função para salvar dados no localStorage
        function saveData() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('bankAccounts', JSON.stringify(bankAccounts));
            localStorage.setItem('creditCards', JSON.stringify(creditCards));
            localStorage.setItem('investments', JSON.stringify(investments));
            localStorage.setItem('goals', JSON.stringify(goals));
            localStorage.setItem('invoices', JSON.stringify(invoices));
            localStorage.setItem('userName', userName);
        }

        // Função para formatar data
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        // Função para formatar mês/ano
        function formatMonthYear(monthYear) {
            const [year, month] = monthYear.split('-');
            const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            return `${monthNames[parseInt(month) - 1]}/${year}`;
        }

        // Função para formatar moeda
        function formatCurrency(amount) {
            return amount >= 0 
                ? 'R$ ' + amount.toLocaleString('pt-BR', { minimumFractionDigits: 2 }) 
                : '- R$ ' + Math.abs(amount).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
        }

        // Função para abrir modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Função para fechar modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Função para atualizar os seletores de ano
        function updateYearSelectors() {
            const years = [];
            const currentYear = new Date().getFullYear();
            
            // Pegar todos os anos presentes nas transações
            transactions.forEach(t => {
                const year = new Date(t.date).getFullYear();
                if (!years.includes(year)) {
                    years.push(year);
                }
            });
            
            // Garantir que temos pelo menos o ano atual
            if (!years.includes(currentYear)) {
                years.push(currentYear);
            }
            
            // Ordenar os anos em ordem decrescente
            years.sort((a, b) => b - a);
            
            // Atualizar todos os seletores de ano
            const yearSelectors = [
                'incomeExpenseYear',
                'expenseDistributionYear',
                'incomeByCategoryYear',
                'expenseByCategoryYear'
            ];
            
            yearSelectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                selector.innerHTML = '';
                
                years.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    if (year === currentYear) {
                        option.selected = true;
                    }
                    selector.appendChild(option);
                });
            });
        }

        // Função para calcular o resumo financeiro
        function calculateFinancialSummary() {
            // Calcular totais de receitas e despesas
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + Math.abs(t.amount), 0);
            
            const balance = totalIncome - totalExpenses;
            
            // Atualizar os cartões do dashboard
            document.getElementById('incomeValue').textContent = `R$ ${totalIncome.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('expenseValue').textContent = `R$ ${totalExpenses.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('balanceValue').textContent = `R$ ${balance.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            
            // Calcular total investido
            const totalInvested = investments.reduce((sum, inv) => sum + inv.amount, 0);
            document.getElementById('investmentValue').textContent = `R$ ${totalInvested.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            
            // Atualizar transações recentes
            updateRecentTransactions();
            
            // Atualizar os gráficos
            updateCharts();
            
            // Atualizar seletores de ano
            updateYearSelectors();
            
            // Salvar dados
            saveData();
        }

        // Função para atualizar transações recentes
        function updateRecentTransactions() {
            const tbody = document.getElementById('recentTransactionsBody');
            tbody.innerHTML = '';
            
            // Ordenar transações por data (mais recente primeiro)
            const sortedTransactions = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Pegar as últimas 5 transações
            const recentTransactions = sortedTransactions.slice(0, 5);
            
            recentTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                
                const categoryText = {
                    'salary': 'Salário',
                    'rent': 'Moradia',
                    'food': 'Alimentação',
                    'transport': 'Transporte',
                    'health': 'Saúde',
                    'leisure': 'Lazer',
                    'education': 'Educação',
                    'investment': 'Investimento',
                    'other': 'Outros'
                };
                
                row.innerHTML = `
                    <td>${transaction.description}</td>
                    <td>${categoryText[transaction.category]}</td>
                    <td>${formatDate(transaction.date)}</td>
                    <td>${formatCurrency(transaction.amount)}</td>
                    <td><span class="status paid">${transaction.type === 'income' ? 'Recebido' : 'Pago'}</span></td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Função para atualizar os gráficos
        function updateCharts() {
            // Obter o ano selecionado para cada gráfico
            const incomeExpenseYear = parseInt(document.getElementById('incomeExpenseYear').value);
            const expenseDistributionYear = parseInt(document.getElementById('expenseDistributionYear').value);
            const incomeByCategoryYear = parseInt(document.getElementById('incomeByCategoryYear').value);
            const expenseByCategoryYear = parseInt(document.getElementById('expenseByCategoryYear').value);
            
            // Atualizar cada gráfico com o ano selecionado
            updateIncomeExpenseChart(incomeExpenseYear);
            updateExpenseDistributionChart(expenseDistributionYear);
            updateIncomeByCategoryChart(incomeByCategoryYear);
            updateExpenseByCategoryChart(expenseByCategoryYear);
        }

        // Função para atualizar o gráfico de Receitas vs Despesas
        function updateIncomeExpenseChart(year) {
            // Destruir gráfico existente se ele já existir
            if (incomeExpenseChart) {
                incomeExpenseChart.destroy();
            }
            
            // Filtrar transações pelo ano selecionado
            const yearTransactions = transactions.filter(t => {
                const transactionYear = new Date(t.date).getFullYear();
                return transactionYear === year;
            });
            
            // Preparar dados para os 12 meses do ano
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const incomeData = Array(12).fill(0);
            const expenseData = Array(12).fill(0);
            
            yearTransactions.forEach(t => {
                const month = new Date(t.date).getMonth();
                if (t.type === 'income') {
                    incomeData[month] += t.amount;
                } else if (t.type === 'expense') {
                    expenseData[month] += Math.abs(t.amount);
                }
            });
            
            // Configurações responsivas para dispositivos móveis
            const isMobile = window.innerWidth <= 768;
            const responsiveOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: isMobile ? 'bottom' : 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': R$ ' + context.raw.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'R$ ' + value.toLocaleString('pt-BR');
                            }
                        }
                    },
                    x: {
                        ticks: {
                            maxRotation: isMobile ? 0 : 45,
                            minRotation: isMobile ? 0 : 45
                        }
                    }
                }
            };
            
            // Criar o gráfico
            const incomeExpenseCtx = document.getElementById('incomeExpenseChart').getContext('2d');
            incomeExpenseChart = new Chart(incomeExpenseCtx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Receitas',
                            data: incomeData,
                            backgroundColor: '#4cc9f0',
                            borderRadius: 6
                        },
                        {
                            label: 'Despesas',
                            data: expenseData,
                            backgroundColor: '#f72585',
                            borderRadius: 6
                        }
                    ]
                },
                options: responsiveOptions
            });
        }

        // Função para atualizar o gráfico de Distribuição de Despesas
        function updateExpenseDistributionChart(year) {
            // Destruir gráfico existente se ele já existir
            if (expenseDistributionChart) {
                expenseDistributionChart.destroy();
            }
            
            // Filtrar transações pelo ano selecionado
            const yearTransactions = transactions.filter(t => {
                const transactionYear = new Date(t.date).getFullYear();
                return transactionYear === year && t.type === 'expense';
            });
            
            // Preparar dados para o gráfico
            const categoryLabels = [];
            const categoryData = [];
            const categoryColors = [
                '#4361ee', '#3f37c9', '#4895ef', '#4cc9f0', 
                '#f8961e', '#f72585', '#7209b7', '#adb5bd'
            ];
            
            const categoryMap = {
                'salary': 'Salário',
                'rent': 'Moradia',
                'food': 'Alimentação',
                'transport': 'Transporte',
                'health': 'Saúde',
                'leisure': 'Lazer',
                'education': 'Educação',
                'investment': 'Investimento',
                'other': 'Outros'
            };
            
            // Agrupar despesas por categoria
            const expensesByCategory = {};
            yearTransactions.forEach(t => {
                const category = t.category;
                const amount = Math.abs(t.amount);
                
                if (!expensesByCategory[category]) {
                    expensesByCategory[category] = 0;
                }
                expensesByCategory[category] += amount;
            });
            
            // Preparar dados para o gráfico
            Object.entries(expensesByCategory).forEach(([category, amount], index) => {
                categoryLabels.push(categoryMap[category] || category);
                categoryData.push(amount);
            });
            
            // Configurações responsivas para dispositivos móveis
            const isMobile = window.innerWidth <= 768;
            const responsiveOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: isMobile ? 'bottom' : 'right',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: R$ ${value.toLocaleString('pt-BR')} (${percentage}%)`;
                            }
                        }
                    }
                },
                cutout: isMobile ? '50%' : '70%'
            };
            
            // Criar o gráfico
            const expenseDistributionCtx = document.getElementById('expenseDistributionChart').getContext('2d');
            expenseDistributionChart = new Chart(expenseDistributionCtx, {
                type: 'doughnut',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        data: categoryData,
                        backgroundColor: categoryColors.slice(0, categoryLabels.length),
                        borderWidth: 0
                    }]
                },
                options: responsiveOptions
            });
        }

        // Função para atualizar o gráfico de Receitas por Categoria
        function updateIncomeByCategoryChart(year) {
            // Destruir gráfico existente se ele já existir
            if (incomeByCategoryChart) {
                incomeByCategoryChart.destroy();
            }
            
            // Filtrar transações pelo ano selecionado
            const yearTransactions = transactions.filter(t => {
                const transactionYear = new Date(t.date).getFullYear();
                return transactionYear === year && t.type === 'income';
            });
            
            // Preparar dados para os 12 meses do ano
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const incomeCategories = {};
            
            // Agrupar receitas por categoria e mês
            yearTransactions.forEach(t => {
                const category = t.category;
                const month = new Date(t.date).getMonth();
                const amount = t.amount;
                
                if (!incomeCategories[category]) {
                    incomeCategories[category] = Array(12).fill(0);
                }
                incomeCategories[category][month] += amount;
            });
            
            // Preparar datasets para o gráfico
            const categoryColors = [
                '#4361ee', '#3f37c9', '#4895ef', '#4cc9f0', 
                '#f8961e', '#f72585', '#7209b7', '#adb5bd'
            ];
            
            const categoryMap = {
                'salary': 'Salário',
                'rent': 'Moradia',
                'food': 'Alimentação',
                'transport': 'Transporte',
                'health': 'Saúde',
                'leisure': 'Lazer',
                'education': 'Educação',
                'investment': 'Investimento',
                'other': 'Outros'
            };
            
            const datasets = Object.entries(incomeCategories).map(([category, amounts], index) => ({
                label: categoryMap[category] || category,
                data: amounts,
                backgroundColor: categoryColors[index % categoryColors.length],
                borderColor: categoryColors[index % categoryColors.length],
                tension: 0.1,
                fill: false
            }));
            
            // Configurações responsivas para dispositivos móveis
            const isMobile = window.innerWidth <= 768;
            const responsiveOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: isMobile ? 'bottom' : 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': R$ ' + context.raw.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
                            }
                        }
                    }

            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return 'R$ ' + value.toLocaleString('pt-BR');
                        }
                    }
                },
                x: {
                    ticks: {
                        maxRotation: isMobile ? 0 : 45,
                        minRotation: isMobile ? 0 : 45
                    }
                }
            }
        };
        // Criar o gráfico
        const incomeByCategoryCtx = document.getElementById('incomeByCategoryChart').getContext('2d');
        incomeByCategoryChart = new Chart(incomeByCategoryCtx, {
            type: 'line',
            data: {
                labels: months,
                datasets: datasets
            },
            options: responsiveOptions
        });
    }

    // Função para atualizar o gráfico de Despesas por Categoria
    function updateExpenseByCategoryChart(year) {
        // Destruir gráfico existente se ele já existir
        if (expenseByCategoryChart) {
            expenseByCategoryChart.destroy();
        }
        // Filtrar transações pelo ano selecionado
        const yearTransactions = transactions.filter(t => {
            const transactionYear = new Date(t.date).getFullYear();
            return transactionYear === year && t.type === 'expense';
        });
        // Preparar dados para os 12 meses do ano
        const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
        const expenseCategories = {};
        // Agrupar despesas por categoria e mês
        yearTransactions.forEach(t => {
            const category = t.category;
            const month = new Date(t.date).getMonth();
            const amount = Math.abs(t.amount);
            if (!expenseCategories[category]) {
                expenseCategories[category] = Array(12).fill(0);
            }
            expenseCategories[category][month] += amount;
        });
        // Preparar datasets para o gráfico
        const categoryColors = [
            '#4361ee', '#3f37c9', '#4895ef', '#4cc9f0', 
            '#f8961e', '#f72585', '#7209b7', '#adb5bd'
        ];
        const categoryMap = {
            'salary': 'Salário',
            'rent': 'Moradia',
            'food': 'Alimentação',
            'transport': 'Transporte',
            'health': 'Saúde',
            'leisure': 'Lazer',
            'education': 'Educação',
            'investment': 'Investimento',
            'other': 'Outros'
        };
        const datasets = Object.entries(expenseCategories).map(([category, amounts], index) => ({
            label: categoryMap[category] || category,
            data: amounts,
            backgroundColor: categoryColors[index % categoryColors.length],
            borderColor: categoryColors[index % categoryColors.length],
            tension: 0.1,
            fill: false
        }));
        // Configurações responsivas para dispositivos móveis
        const isMobile = window.innerWidth <= 768;
        const responsiveOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: isMobile ? 'bottom' : 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': R$ ' + context.raw.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return 'R$ ' + value.toLocaleString('pt-BR');
                        }
                    }
                },
                x: {
                    ticks: {
                        maxRotation: isMobile ? 0 : 45,
                        minRotation: isMobile ? 0 : 45
                    }
                }
            }
        };
        // Criar o gráfico
        const expenseByCategoryCtx = document.getElementById('expenseByCategoryChart').getContext('2d');
        expenseByCategoryChart = new Chart(expenseByCategoryCtx, {
            type: 'line',
            data: {
                labels: months,
                datasets: datasets
            },
            options: responsiveOptions
        });
    }

    // Função para inicializar o dashboard
    function initializeDashboard() {
        calculateFinancialSummary();
        populateTables();
        setupEventListeners();
    }

    // Função para popular todas as tabelas
    function populateTables() {
        populateTransactionsTable();
        populateCreditCards();
        populateInvoices();
        populateInvestmentsTable();
        populateGoalsTable();
        populateBankAccounts();
        populateCategories();
    }

    // Função para popular tabela de transações
    function populateTransactionsTable() {
        const tbody = document.getElementById('transactionsTableBody');
        tbody.innerHTML = '';
        transactions.forEach(transaction => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${transaction.description}</td>
                <td>${transaction.type === 'income' ? 'Receita' : transaction.type === 'expense' ? 'Despesa' : 'Investimento'}</td>
                <td>${getCategoryName(transaction.category)}</td>
                <td>${formatDate(transaction.date)}</td>
                <td>${formatCurrency(transaction.amount)}</td>
                <td>
                    <button class="btn btn-sm btn-primary" onclick="openEditTransactionModal(${transaction.id})">Editar</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteTransaction(${transaction.id})">Excluir</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // Função para popular cartões de crédito
    function populateCreditCards() {
        const container = document.getElementById('creditCardsContainer');
        container.innerHTML = '';
        creditCards.forEach(card => {
            const cardElement = document.createElement('div');
            cardElement.classList.add('card');
            cardElement.innerHTML = `
                <div class="card-header">
                    <h3 class="card-title">${card.name}</h3>
                    <div class="card-icon balance">
                        <i class="fas fa-credit-card"></i>
                    </div>
                </div>
                <div class="card-value">${card.number}</div>
                <div class="card-footer">Limite: ${formatCurrency(card.limit)}</div>
                <button class="btn btn-primary btn-block" style="margin-top: 1rem;" onclick="openEditCardModal(${card.id})">Editar Cartão</button>
            `;
            container.appendChild(cardElement);
        });
    }

    // Função para popular faturas
    function populateInvoices() {
        const container = document.getElementById('invoicesCardsContainer');
        const tbody = document.getElementById('invoicesTableBody');
        container.innerHTML = '';
        tbody.innerHTML = '';
        invoices.forEach(invoice => {
            const card = creditCards.find(c => c.id === invoice.cardId);
            if (card) {
                const statusClass = invoice.status === 'paid' ? 'paid' : invoice.status === 'pending' ? 'pending' : 'overdue';
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${card.name}</td>
                    <td>${formatMonthYear(invoice.month)}</td>
                    <td>${formatCurrency(invoice.amount)}</td>
                    <td><span class="status ${statusClass}">${getStatusText(invoice.status)}</span></td>
                    <td>${invoice.paymentDate ? formatDate(invoice.paymentDate) : '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="openEditInvoiceModal(${invoice.id})">Editar</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteInvoice(${invoice.id})">Excluir</button>
                    </td>
                `;
                tbody.appendChild(row);
            }
        });
    }

    // Função para popular tabela de investimentos
    function populateInvestmentsTable() {
        const tbody = document.getElementById('investmentsTableBody');
        tbody.innerHTML = '';
        investments.forEach(investment => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${investment.name}</td>
                <td>${getInvestmentTypeName(investment.type)}</td>
                <td>${investment.quantity}</td>
                <td>${formatCurrency(investment.amount)}</td>
                <td>${formatCurrency(investment.currentValue || 0)}</td>
                <td>${calculateInvestmentReturn(investment)}%</td>
                <td>
                    <button class="btn btn-sm btn-primary" onclick="openEditInvestmentModal(${investment.id})">Editar</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteInvestment(${investment.id})">Excluir</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // Função para popular tabela de metas
    function populateGoalsTable() {
        const tbody = document.getElementById('goalsTableBody');
        tbody.innerHTML = '';
        goals.forEach(goal => {
            const progress = (goal.current / goal.target) * 100;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${goal.name}</td>
                <td>${formatCurrency(goal.target)}</td>
                <td>${formatCurrency(goal.current)}</td>
                <td>
                    <div class="progress-container">
                        <div class="progress-bar" style="width: ${progress}%; background-color: ${progress >= 100 ? '#4cc9f0' : '#f8961e'};"></div>
                    </div>
                </td>
                <td>${formatDate(goal.deadline)}</td>
                <td>
                    <button class="btn btn-sm btn-primary" onclick="openEditGoalModal(${goal.id})">Editar</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteGoal(${goal.id})">Excluir</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // Função para popular contas bancárias
    function populateBankAccounts() {
        const list = document.getElementById('bankAccountsList');
        list.innerHTML = '';
        bankAccounts.forEach(account => {
            const item = document.createElement('li');
            item.textContent = `${account.bank} - ${getAccountTypeName(account.type)}`;
            list.appendChild(item);
        });
    }

    // Função para popular categorias
    function populateCategories() {
        const list = document.getElementById('categoriesList');
        list.innerHTML = '';
        categories.forEach(category => {
            const item = document.createElement('li');
            item.textContent = category;
            list.appendChild(item);
        });
    }

    // Função para configurar ouvintes de eventos
    function setupEventListeners() {
        // Menu hamburguer
        document.getElementById('hamburgerMenu').addEventListener('click', toggleSidebar);
        document.getElementById('overlay').addEventListener('click', closeSidebar);

        // Formulários
        document.getElementById('transactionForm').addEventListener('submit', handleAddTransaction);
        document.getElementById('cardForm').addEventListener('submit', handleAddCard);
        document.getElementById('invoiceForm').addEventListener('submit', handleAddInvoice);
        document.getElementById('investmentForm').addEventListener('submit', handleAddInvestment);
        document.getElementById('goalForm').addEventListener('submit', handleAddGoal);

        // Modais
        document.getElementById('editTransactionForm').addEventListener('submit', handleEditTransaction);
        document.getElementById('editCardForm').addEventListener('submit', handleEditCard);
        document.getElementById('editInvoiceForm').addEventListener('submit', handleEditInvoice);
        document.getElementById('editInvestmentForm').addEventListener('submit', handleEditInvestment);
        document.getElementById('editGoalForm').addEventListener('submit', handleEditGoal);

        // Salvamento de perfil
        document.getElementById('saveProfileBtn').addEventListener('click', handleSaveProfile);

        // Seletores de ano
        document.getElementById('incomeExpenseYear').addEventListener('change', updateIncomeExpenseChart);
        document.getElementById('expenseDistributionYear').addEventListener('change', updateExpenseDistributionChart);
        document.getElementById('incomeByCategoryYear').addEventListener('change', updateIncomeByCategoryChart);
        document.getElementById('expenseByCategoryYear').addEventListener('change', updateExpenseByCategoryChart);
    }

    // Manipuladores de eventos para formulários
    function handleAddTransaction(e) {
        e.preventDefault();
        const description = document.getElementById('description').value;
        const amount = parseFloat(document.getElementById('amount').value);
        const type = document.getElementById('type').value;
        const category = document.getElementById('category').value;
        const date = document.getElementById('date').value;

        if (!description || !amount || !type || !category || !date) {
            alert('Preencha todos os campos.');
            return;
        }

        const newTransaction = {
            id: transactions.length > 0 ? transactions[transactions.length - 1].id + 1 : 1,
            description,
            amount: type === 'expense' ? -Math.abs(amount) : amount,
            type,
            category,
            date
        };

        transactions.push(newTransaction);
        saveData();
        calculateFinancialSummary();
        populateTransactionsTable();
        e.target.reset();
    }

    function handleAddCard(e) {
        e.preventDefault();
        const name = document.getElementById('cardName').value;
        const number = document.getElementById('cardNumber').value;
        const limit = parseFloat(document.getElementById('cardLimit').value);
        const dueDay = parseInt(document.getElementById('cardDueDay').value);

        if (!name || !number || !limit || !dueDay) {
            alert('Preencha todos os campos.');
            return;
        }

        const newCard = {
            id: creditCards.length > 0 ? creditCards[creditCards.length - 1].id + 1 : 1,
            name,
            number: `**** **** **** ${number.slice(-4)}`,
            limit,
            dueDay
        };

        creditCards.push(newCard);
        saveData();
        populateCreditCards();
        e.target.reset();
    }

    function handleAddInvoice(e) {
        e.preventDefault();
        const cardId = parseInt(document.getElementById('invoiceCard').value);
        const month = document.getElementById('invoiceMonth').value;
        const amount = parseFloat(document.getElementById('invoiceAmount').value);
        const status = document.getElementById('invoiceStatus').value;
        const dueDate = document.getElementById('invoiceDueDate').value;
        const paymentDate = document.getElementById('invoicePaymentDate').value;

        if (!cardId || !month || !amount || !status || !dueDate) {
            alert('Preencha todos os campos.');
            return;
        }

        const newInvoice = {
            id: invoices.length > 0 ? invoices[invoices.length - 1].id + 1 : 1,
            cardId,
            month,
            amount,
            status,
            dueDate,
            paymentDate: paymentDate || ''
        };

        invoices.push(newInvoice);
        saveData();
        populateInvoices();
        e.target.reset();
    }

    function handleAddInvestment(e) {
        e.preventDefault();
        const name = document.getElementById('investmentName').value;
        const type = document.getElementById('investmentType').value;
        const amount = parseFloat(document.getElementById('investmentAmount').value);
        const quantity = parseInt(document.getElementById('investmentQuantity').value);
        const currentValue = parseFloat(document.getElementById('investmentCurrentValue').value) || 0;
        const date = document.getElementById('investmentDate').value;

        if (!name || !type || !amount || !quantity || !date) {
            alert('Preencha todos os campos obrigatórios.');
            return;
        }

        const newInvestment = {
            id: investments.length > 0 ? investments[investments.length - 1].id + 1 : 1,
            name,
            type,
            amount,
            quantity,
            currentValue,
            date
        };

        investments.push(newInvestment);
        saveData();
        populateInvestmentsTable();
        e.target.reset();
    }

    function handleAddGoal(e) {
        e.preventDefault();
        const name = document.getElementById('goalName').value;
        const target = parseFloat(document.getElementById('goalTarget').value);
        const current = parseFloat(document.getElementById('goalCurrent').value);
        const deadline = document.getElementById('goalDeadline').value;

        if (!name || !target || !current || !deadline) {
            alert('Preencha todos os campos.');
            return;
        }

        const newGoal = {
            id: goals.length > 0 ? goals[goals.length - 1].id + 1 : 1,
            name,
            target,
            current,
            deadline
        };

        goals.push(newGoal);
        saveData();
        populateGoalsTable();
        e.target.reset();
    }

    function handleSaveProfile() {
        const fullName = document.getElementById('userFullName').value;
        if (fullName) {
            userName = fullName;
            document.querySelectorAll('.user-avatar').forEach(avatar => {
                avatar.textContent = getInitials(fullName);
            });
            document.querySelectorAll('[id^="userName"]').forEach(el => {
                el.textContent = fullName;
            });
            saveData();
        } else {
            alert('Insira um nome válido.');
        }
    }

    // Funções auxiliares
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const mainContent = document.getElementById('mainContent');
        const hamburger = document.getElementById('hamburgerMenu');

        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
        mainContent.classList.toggle('shifted');
        hamburger.classList.toggle('active');
    }

    function closeSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const mainContent = document.getElementById('mainContent');
        const hamburger = document.getElementById('hamburgerMenu');

        sidebar.classList.remove('active');
        overlay.classList.remove('active');
        mainContent.classList.remove('shifted');
        hamburger.classList.remove('active');
    }

    function openEditTransactionModal(id) {
        const transaction = transactions.find(t => t.id === id);
        if (transaction) {
            document.getElementById('editTransactionId').value = transaction.id;
            document.getElementById('editDescription').value = transaction.description;
            document.getElementById('editAmount').value = Math.abs(transaction.amount);
            document.getElementById('editType').value = transaction.type;
            document.getElementById('editCategory').value = transaction.category;
            document.getElementById('editDate').value = transaction.date;
            openModal('editTransactionModal');
        }
    }

    function handleEditTransaction(e) {
        e.preventDefault();
        const id = parseInt(document.getElementById('editTransactionId').value);
        const description = document.getElementById('editDescription').value;
        const amount = parseFloat(document.getElementById('editAmount').value);
        const type = document.getElementById('editType').value;
        const category = document.getElementById('editCategory').value;
        const date = document.getElementById('editDate').value;

        if (!description || !amount || !type || !category || !date) {
            alert('Preencha todos os campos.');
            return;
        }

        const transactionIndex = transactions.findIndex(t => t.id === id);
        if (transactionIndex !== -1) {
            transactions[transactionIndex] = {
                ...transactions[transactionIndex],
                description,
                amount: type === 'expense' ? -Math.abs(amount) : amount,
                type,
                category,
                date
            };
            saveData();
            calculateFinancialSummary();
            populateTransactionsTable();
            closeModal('editTransactionModal');
        }
    }

    function deleteTransaction(id) {
        if (confirm('Tem certeza que deseja excluir esta transação?')) {
            transactions = transactions.filter(t => t.id !== id);
            saveData();
            calculateFinancialSummary();
            populateTransactionsTable();
        }
    }

    function openEditCardModal(id) {
        const card = creditCards.find(c => c.id === id);
        if (card) {
            document.getElementById('editCardId').value = card.id;
            document.getElementById('editCardName').value = card.name;
            document.getElementById('editCardNumber').value = card.number.replace(/[\*\s]/g, '');
            document.getElementById('editCardLimit').value = card.limit;
            document.getElementById('editCardDueDay').value = card.dueDay;
            openModal('editCardModal');
        }
    }

    function handleEditCard(e) {
        e.preventDefault();
        const id = parseInt(document.getElementById('editCardId').value);
        const name = document.getElementById('editCardName').value;
        const number = document.getElementById('editCardNumber').value;
        const limit = parseFloat(document.getElementById('editCardLimit').value);
        const dueDay = parseInt(document.getElementById('editCardDueDay').value);

        if (!name || !number || !limit || !dueDay) {
            alert('Preencha todos os campos.');
            return;
        }

        const cardIndex = creditCards.findIndex(c => c.id === id);
        if (cardIndex !== -1) {
            creditCards[cardIndex] = {
                ...creditCards[cardIndex],
                name,
                number: `**** **** **** ${number.slice(-4)}`,
                limit,
                dueDay
            };
            saveData();
            populateCreditCards();
            closeModal('editCardModal');
        }
    }

    function openEditInvoiceModal(id) {
        const invoice = invoices.find(i => i.id === id);
        if (invoice) {
            document.getElementById('editInvoiceId').value = invoice.id;
            document.getElementById('editInvoiceCard').value = invoice.cardId;
            document.getElementById('editInvoiceMonth').value = invoice.month;
            document.getElementById('editInvoiceAmount').value = invoice.amount;
            document.getElementById('editInvoiceStatus').value = invoice.status;
            document.getElementById('editInvoiceDueDate').value = invoice.dueDate;
            document.getElementById('editInvoicePaymentDate').value = invoice.paymentDate;
            openModal('editInvoiceModal');
        }
    }

    function handleEditInvoice(e) {
        e.preventDefault();
        const id = parseInt(document.getElementById('editInvoiceId').value);
        const cardId = parseInt(document.getElementById('editInvoiceCard').value);
        const month = document.getElementById('editInvoiceMonth').value;
        const amount = parseFloat(document.getElementById('editInvoiceAmount').value);
        const status = document.getElementById('editInvoiceStatus').value;
        const dueDate = document.getElementById('editInvoiceDueDate').value;
        const paymentDate = document.getElementById('editInvoicePaymentDate').value;

        if (!cardId || !month || !amount || !status || !dueDate) {
            alert('Preencha todos os campos.');
            return;
        }

        const invoiceIndex = invoices.findIndex(i => i.id === id);
        if (invoiceIndex !== -1) {
            invoices[invoiceIndex] = {
                ...invoices[invoiceIndex],
                cardId,
                month,
                amount,
                status,
                dueDate,
                paymentDate: paymentDate || ''
            };
            saveData();
            populateInvoices();
            closeModal('editInvoiceModal');
        }
    }

    function deleteInvoice(id) {
        if (confirm('Tem certeza que deseja excluir esta fatura?')) {
            invoices = invoices.filter(i => i.id !== id);
            saveData();
            populateInvoices();
        }
    }

    function openEditInvestmentModal(id) {
        const investment = investments.find(i => i.id === id);
        if (investment) {
            document.getElementById('editInvestmentId').value = investment.id;
            document.getElementById('editInvestmentName').value = investment.name;
            document.getElementById('editInvestmentType').value = investment.type;
            document.getElementById('editInvestmentAmount').value = investment.amount;
            document.getElementById('editInvestmentQuantity').value = investment.quantity;
            document.getElementById('editInvestmentCurrentValue').value = investment.currentValue || '';
            document.getElementById('editInvestmentDate').value = investment.date;
            openModal('editInvestmentModal');
        }
    }

    function handleEditInvestment(e) {
        e.preventDefault();
        const id = parseInt(document.getElementById('editInvestmentId').value);
        const name = document.getElementById('editInvestmentName').value;
        const type = document.getElementById('editInvestmentType').value;
        const amount = parseFloat(document.getElementById('editInvestmentAmount').value);
        const quantity = parseInt(document.getElementById('editInvestmentQuantity').value);
        const currentValue = parseFloat(document.getElementById('editInvestmentCurrentValue').value) || 0;
        const date = document.getElementById('editInvestmentDate').value;

        if (!name || !type || !amount || !quantity || !date) {
            alert('Preencha todos os campos obrigatórios.');
            return;
        }

        const investmentIndex = investments.findIndex(i => i.id === id);
        if (investmentIndex !== -1) {
            investments[investmentIndex] = {
                ...investments[investmentIndex],
                name,
                type,
                amount,
                quantity,
                currentValue,
                date
            };
            saveData();
            populateInvestmentsTable();
            closeModal('editInvestmentModal');
        }
    }

    function deleteInvestment(id) {
        if (confirm('Tem certeza que deseja excluir este investimento?')) {
            investments = investments.filter(i => i.id !== id);
            saveData();
            populateInvestmentsTable();
        }
    }

    function openEditGoalModal(id) {
        const goal = goals.find(g => g.id === id);
        if (goal) {
            document.getElementById('editGoalId').value = goal.id;
            document.getElementById('editGoalName').value = goal.name;
            document.getElementById('editGoalTarget').value = goal.target;
            document.getElementById('editGoalCurrent').value = goal.current;
            document.getElementById('editGoalDeadline').value = goal.deadline;
            openModal('editGoalModal');
        }
    }

    function handleEditGoal(e) {
        e.preventDefault();
        const id = parseInt(document.getElementById('editGoalId').value);
        const name = document.getElementById('editGoalName').value;
        const target = parseFloat(document.getElementById('editGoalTarget').value);
        const current = parseFloat(document.getElementById('editGoalCurrent').value);
        const deadline = document.getElementById('editGoalDeadline').value;

        if (!name || !target || !current || !deadline) {
            alert('Preencha todos os campos.');
            return;
        }

        const goalIndex = goals.findIndex(g => g.id === id);
        if (goalIndex !== -1) {
            goals[goalIndex] = {
                ...goals[goalIndex],
                name,
                target,
                current,
                deadline
            };
            saveData();
            populateGoalsTable();
            closeModal('editGoalModal');
        }
    }

    function deleteGoal(id) {
        if (confirm('Tem certeza que deseja excluir esta meta?')) {
            goals = goals.filter(g => g.id !== id);
            saveData();
            populateGoalsTable();
        }
    }

    // Funções utilitárias
    function getCategoryName(category) {
        const categoryMap = {
            'salary': 'Salário',
            'rent': 'Moradia',
            'food': 'Alimentação',
            'transport': 'Transporte',
            'health': 'Saúde',
            'leisure': 'Lazer',
            'education': 'Educação',
            'investment': 'Investimento',
            'other': 'Outros'
        };
        return categoryMap[category] || category;
    }

    function getInvestmentTypeName(type) {
        const typeMap = {
            'fixed-income': 'Renda Fixa',
            'stocks': 'Ações',
            'fii': 'Fundo Imobiliário',
            'treasury': 'Tesouro Direto',
            'etf': 'ETF'
        };
        return typeMap[type] || type;
    }

    function getAccountTypeName(type) {
        const typeMap = {
            'checking': 'Conta Corrente',
            'savings': 'Conta Poupança',
            'investment': 'Conta Investimento'
        };
        return typeMap[type] || type;
    }

    function getStatusText(status) {
        const statusMap = {
            'paid': 'Pago',
            'pending': 'Pendente',
            'overdue': 'Atrasado'
        };
        return statusMap[status] || status;
    }

    function calculateInvestmentReturn(investment) {
        if (investment.currentValue && investment.amount) {
            return (((investment.currentValue - investment.amount) / investment.amount) * 100).toFixed(2);
        }
        return '0.00';
    }

    function getInitials(name) {
        return name.split(' ').map(word => word[0]).join('').toUpperCase().slice(0, 2);
    }

    // Inicialização
    document.addEventListener('DOMContentLoaded', () => {
        // Atualizar nome do usuário
        document.querySelectorAll('.user-avatar').forEach(avatar => {
            avatar.textContent = getInitials(userName);
        });
        document.querySelectorAll('[id^="userName"]').forEach(el => {
            el.textContent = userName;
        });

        // Inicializar dashboard
        initializeDashboard();
    });
</script>
</body>
</html>
